<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ title or "Information Security Fall 2025 Lab" }}</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <header class="site-header">
      <div class="brand">
        <div class="cmu-bar"></div>
        <h1>
          <a href="{{ url_for('index') }}"
            >Information Security Fall 2025 Lab</a
          >
        </h1>
        <span class="sub">CMU-Africa</span>
      </div>
      <nav class="nav">
        {% if session.user_id %}
        <span class="welcome">Hi, {{ session.user_name }}</span>
        <a class="btn btn-outline" href="{{ url_for('dashboard') }}"
          >Dashboard</a
        >
        {% if session.user_role in ['user_admin', 'data_admin'] %}
        <a class="btn btn-outline" href="{{ url_for('admin_users') }}">Administration</a>
        {% endif %}
        <a class="btn" href="{{ url_for('logout') }}">Logout</a>
        {% else %}
        <a class="btn" href="{{ url_for('login') }}">Login</a>
        <a class="btn btn-outline" href="{{ url_for('register') }}">Register</a>
        {% endif %}
      </nav>
    </header>
    <main class="container">
      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %}
      <div class="flashes">
        {% for category, message in messages %}
        <div class="flash {{ category }}">{{ message }}</div>
        {% endfor %}
      </div>
      {% endif %} {% endwith %} {% block content %}{% endblock %}
    </main>
    <footer class="site-footer">
      <p>
        &copy; {{ 2025 }} Information Security Fall 2025 Lab â€¢ For educational
        use only.
      </p>
    </footer>
  <script>
document.addEventListener('DOMContentLoaded', function () {
  document.querySelectorAll('.toggle-password').forEach(function (btn) {
    btn.addEventListener('click', function () {
      const wrap = btn.closest('.password-wrapper');
      if (!wrap) return;
      const input = wrap.querySelector('input[type="password"], input[type="text"]');
      if (!input) return;
      const showing = input.type === 'text';
      input.type = showing ? 'password' : 'text';
      btn.setAttribute('aria-pressed', String(!showing));
      btn.setAttribute('aria-label', showing ? 'Show password' : 'Hide password');
      btn.classList.toggle('is-visible', !showing);
    });
  });
});
</script>
{% block scripts %}
<script>
    // --- Scripts for Admin Modals and Tables ---

  // RENAME MODAL LOGIC
  const modal = document.getElementById("renameModal");
  if (modal) {
    const renameForm = document.getElementById("renameForm");
    const newNameInput = document.getElementById("new_name");
    const modalTitle = document.getElementById("renameModalTitle");

    function openRenameModal(userId, andrewId, currentName) {
      renameForm.action = `/admin/change-username/${userId}`;
      newNameInput.value = currentName;
      modalTitle.innerText = `Rename user: ${andrewId}`;
      modal.style.display = "block";
      newNameInput.focus();
    }

    function closeRenameModal() {
      modal.style.display = "none";
    }

    window.onclick = function(event) {
      if (event.target == modal) {
        closeRenameModal();
      }
    }
  }

  // SORTABLE TABLE LOGIC
  let lastSortedColumn = -1;
  let sortDirection = 'asc';

  function sortTable(columnIndex, type = 'string') {
    const tableBody = document.getElementById("logTableBody");
    if (!tableBody) return;

    const rows = Array.from(tableBody.querySelectorAll("tr"));
    
    if (columnIndex === lastSortedColumn) {
      sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
    } else {
      sortDirection = 'asc';
    }

    rows.sort((a, b) => {
      const cellA = a.cells[columnIndex].innerText.trim();
      const cellB = b.cells[columnIndex].innerText.trim();

      let compareResult = 0;
      if (type === 'date') {
        compareResult = new Date(cellA) - new Date(cellB);
      } else {
        compareResult = cellA.localeCompare(cellB, undefined, { numeric: true });
      }
      return sortDirection === 'asc' ? compareResult : -compareResult;
    });

    document.querySelectorAll('.table thead th').forEach((th, index) => {
      th.classList.remove('sort-asc', 'sort-desc');
      if (index === columnIndex) {
        th.classList.add(sortDirection === 'asc' ? 'sort-asc' : 'sort-desc');
      }
    });

    tableBody.innerHTML = "";
    rows.forEach(row => tableBody.appendChild(row));

    lastSortedColumn = columnIndex;
  }
</script>
</script>
{% endblock %}
</body>
</html>
